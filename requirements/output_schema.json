{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "SPD Comparison Three-Output Schema",
  "description": "JSON structure for the three required outputs: Summary, Comparison Spreadsheet, and Language Comparison. Designed to be plan-agnostic and work with any number of plan units detected.",
  "type": "object",
  "required": ["plan_units", "summary", "comparison_spreadsheet", "language_comparison"],
  "properties": {
    "plan_units": {
      "type": "array",
      "description": "Array of plan unit names detected from uploaded documents, in consistent order used throughout all outputs",
      "items": {
        "type": "string"
      },
      "example": ["San Diego Plan", "Las Vegas Plan", "Sacramento Plan"]
    },
    "summary": {
      "type": "object",
      "description": "Output 1: Executive summary in markdown format",
      "required": ["document_inventory", "key_findings", "completeness_assessment", "recommendations"],
      "properties": {
        "document_inventory": {
          "type": "array",
          "description": "List of all documents analyzed, organized by plan unit",
          "items": {
            "type": "object",
            "properties": {
              "plan_unit": {
                "type": "string",
                "example": "San Diego"
              },
              "documents": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "type": {
                      "type": "string",
                      "enum": ["SPD", "SMM"],
                      "description": "Document type"
                    },
                    "effective_date": {
                      "type": "string",
                      "description": "Effective date in YYYY-MM-DD format",
                      "example": "2020-12-01"
                    },
                    "filename": {
                      "type": "string",
                      "description": "Original filename"
                    }
                  }
                }
              }
            }
          }
        },
        "key_findings": {
          "type": "array",
          "description": "3-5 most critical differences or findings",
          "items": {
            "type": "string"
          },
          "minItems": 3,
          "maxItems": 5
        },
        "completeness_assessment": {
          "type": "string",
          "description": "Assessment of document completeness and any gaps"
        },
        "recommendations": {
          "type": "array",
          "description": "Actionable recommendations for the merger team",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "comparison_spreadsheet": {
      "type": "object",
      "description": "Output 2: Summary-level comparison across all plans (single sheet). Plan values array corresponds to plan_units array order.",
      "required": ["rows"],
      "properties": {
        "rows": {
          "type": "array",
          "description": "Each row represents one procedure element with summary statements for each plan",
          "items": {
            "type": "object",
            "required": ["procedure_element", "plan_values"],
            "properties": {
              "procedure_element": {
                "type": "string",
                "description": "Name of the procedure element being compared",
                "example": "Appeals Filing Deadline"
              },
              "plan_values": {
                "type": "array",
                "description": "Array of summary statements, one per plan in same order as plan_units array",
                "items": {
                  "type": "string"
                },
                "example": ["60 days after receipt of written denial notice", "90 days after receipt", "60 days"]
              }
            }
          }
        }
      }
    },
    "language_comparison": {
      "type": "object",
      "description": "Output 3: Full quoted language with citations for attorney drafting (single sheet). Plan details array corresponds to plan_units array order.",
      "required": ["rows"],
      "properties": {
        "rows": {
          "type": "array",
          "description": "Each row contains full language comparison for one procedure element across all plans",
          "items": {
            "type": "object",
            "required": ["procedure_element", "plan_details"],
            "properties": {
              "procedure_element": {
                "type": "string",
                "description": "Name of the procedure element",
                "example": "Appeals Filing Deadline"
              },
              "plan_details": {
                "type": "array",
                "description": "Full language details for each plan in same order as plan_units array",
                "items": {
                  "type": "object",
                  "required": ["summary", "full_text", "citation"],
                  "properties": {
                    "summary": {
                      "type": "string",
                      "description": "Brief summary statement (matches comparison_spreadsheet entry)",
                      "example": "60 days after receipt of written denial notice"
                    },
                    "full_text": {
                      "type": "string",
                      "description": "Complete quoted paragraph(s) - verbatim legal language",
                      "example": "A claimant shall have sixty (60) days following receipt of written notification of denial of benefits to file a written appeal to the Board of Trustees..."
                    },
                    "citation": {
                      "type": "string",
                      "description": "Precise page and paragraph reference",
                      "example": "SPD Page 47, Paragraph 3"
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
